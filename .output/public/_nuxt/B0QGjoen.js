import{_ as Q}from"./9Izdmuga.js";import{_ as ae}from"./oZfRzh-Q.js";import{_ as se}from"./CdYq105T.js";import{_ as ne}from"./BRXEsc8B.js";import{_ as oe}from"./BvTw6xzz.js";import{g as X,h as q,u as K,m as re,r as z,i as Y,j as Z,D as ie,B as D,w as T,E as le,f as R,o as v,a as e,c as f,l as C,b as I,F as E,p as U,t as r,d as O,z as de,C as ce,e as ue,q as W}from"./CyjY5H8A.js";import{u as A}from"./JGZA2kR1.js";import{u as me}from"./6jrzLyMP.js";import"./DlAUqK2U.js";import"./CLdyUvtB.js";var ve=typeof global=="object"&&global&&global.Object===Object&&global,ge=typeof self=="object"&&self&&self.Object===Object&&self,ee=ve||ge||Function("return this")(),N=ee.Symbol,te=Object.prototype,fe=te.hasOwnProperty,pe=te.toString,L=N?N.toStringTag:void 0;function ye(t){var i=fe.call(t,L),y=t[L];try{t[L]=void 0;var p=!0}catch{}var $=pe.call(t);return p&&(i?t[L]=y:delete t[L]),$}var he=Object.prototype,_e=he.toString;function be(t){return _e.call(t)}var xe="[object Null]",ke="[object Undefined]",H=N?N.toStringTag:void 0;function we(t){return t==null?t===void 0?ke:xe:H&&H in Object(t)?ye(t):be(t)}function ze(t){return t!=null&&typeof t=="object"}var $e="[object Symbol]";function je(t){return typeof t=="symbol"||ze(t)&&we(t)==$e}var Me=/\s/;function Ce(t){for(var i=t.length;i--&&Me.test(t.charAt(i)););return i}var Te=/^\s+/;function Se(t){return t&&t.slice(0,Ce(t)+1).replace(Te,"")}function P(t){var i=typeof t;return t!=null&&(i=="object"||i=="function")}var G=NaN,Ie=/^[-+]0x[0-9a-f]+$/i,Oe=/^0b[01]+$/i,Ve=/^0o[0-7]+$/i,Be=parseInt;function J(t){if(typeof t=="number")return t;if(je(t))return G;if(P(t)){var i=typeof t.valueOf=="function"?t.valueOf():t;t=P(i)?i+"":i}if(typeof t!="string")return t===0?t:+t;t=Se(t);var y=Oe.test(t);return y||Ve.test(t)?Be(t.slice(2),y?2:8):Ie.test(t)?G:+t}var F=function(){return ee.Date.now()},Le="Expected a function",De=Math.max,Ee=Math.min;function Ue(t,i,y){var p,$,b,o,c,g,d=0,M=!1,k=!1,x=!0;if(typeof t!="function")throw new TypeError(Le);i=J(i)||0,P(y)&&(M=!!y.leading,k="maxWait"in y,b=k?De(J(y.maxWait)||0,i):b,x="trailing"in y?!!y.trailing:x);function j(a){var _=p,S=$;return p=$=void 0,d=a,o=t.apply(S,_),o}function V(a){return d=a,c=setTimeout(n,i),M?j(a):o}function B(a){var _=a-g,S=a-d,w=i-_;return k?Ee(w,b-S):w}function s(a){var _=a-g,S=a-d;return g===void 0||_>=i||_<0||k&&S>=b}function n(){var a=F();if(s(a))return u(a);c=setTimeout(n,B(a))}function u(a){return c=void 0,x&&p?j(a):(p=$=void 0,o)}function l(){c!==void 0&&clearTimeout(c),d=0,p=g=$=c=void 0}function m(){return c===void 0?o:u(F())}function h(){var a=F(),_=s(a);if(p=arguments,$=this,g=a,_){if(c===void 0)return V(g);if(k)return clearTimeout(c),c=setTimeout(n,i),j(g)}return c===void 0&&(c=setTimeout(n,i)),o}return h.cancel=l,h.flush=m,h}const Ne={class:"relative"},Fe={key:0,class:"absolute z-10 mt-1 w-full bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 max-h-60 overflow-auto"},Re=["onClick"],Ae={class:"w-8 h-8 bg-primary-500 rounded-full flex items-center justify-center text-white font-medium text-sm"},Pe={class:"flex-1 min-w-0"},We={class:"text-sm font-medium text-gray-900 dark:text-gray-100"},He={class:"text-xs text-gray-600 dark:text-gray-400 truncate"},Ge={key:1,class:"absolute right-3 top-10"},Je={key:0,class:"bg-gray-50 dark:bg-gray-900 rounded-lg p-4 flex items-center justify-between"},Qe={class:"flex items-center gap-3"},Xe={class:"w-10 h-10 bg-primary-500 rounded-full flex items-center justify-center text-white font-medium"},qe={class:"font-medium text-gray-900 dark:text-gray-100"},Ke={class:"text-sm text-gray-600 dark:text-gray-400"},Ye={key:1,class:"text-sm text-red-600 dark:text-red-400"},Ze={class:"flex justify-end gap-3 pt-4"},et=X({__name:"InviteMemberModal",props:{modelValue:{type:Boolean},organizationId:{}},emits:["update:modelValue","invited"],setup(t,{emit:i}){const y=t,p=i,{$rpc:$}=q(),{t:b}=K(),o=re({get:()=>y.modelValue,set:l=>p("update:modelValue",l)}),c=z(""),g=z([]),d=z(null),M=z(!1),k=z(!1),x=z(""),j=z(!1),V=async l=>{if(!l||l.length<1){g.value=[];return}M.value=!0,x.value="";try{const m=await $.users.searchByUsername({username:l,limit:10});g.value=m,j.value=!0}catch(m){console.error("Failed to search users:",m),g.value=[]}finally{M.value=!1}},B=Ue(l=>{const m=l.target.value;V(m)},300),s=l=>{d.value=l,c.value=l.username,j.value=!1},n=async()=>{var l,m;if(d.value){k.value=!0,x.value="";try{await $.organizations.inviteMember({organizationId:y.organizationId,username:d.value.username}),p("invited",d.value),o.value=!1;const{showToast:h}=A();h({message:b("organizations.inviteMember.success",{username:d.value.username}),type:"success"})}catch(h){console.error("Failed to invite member:",h),h instanceof Error&&((l=h.message)!=null&&l.includes("already a member"))?x.value=b("organizations.inviteMember.alreadyMember"):h instanceof Error&&((m=h.message)!=null&&m.includes("invitation has already been sent"))?x.value=b("organizations.inviteMember.alreadyInvited"):x.value=b("organizations.inviteMember.error")}finally{k.value=!1}}},u=()=>{o.value=!1};return Y(o,l=>{l||(c.value="",g.value=[],d.value=null,x.value="",j.value=!1)}),Z(()=>{const l=m=>{m.target.closest(".relative")||(j.value=!1)};document.addEventListener("click",l),ie(()=>{document.removeEventListener("click",l)})}),(l,m)=>{const h=se,a=ne,_=Q,S=oe;return v(),D(S,{modelValue:R(o),"onUpdate:modelValue":m[2]||(m[2]=w=>le(o)?o.value=w:null),title:l.$t("organizations.inviteMember.title")},{default:T(()=>[e("form",{onSubmit:de(n,["prevent"]),class:"space-y-4"},[e("div",Ne,[I(h,{modelValue:c.value,"onUpdate:modelValue":m[0]||(m[0]=w=>c.value=w),onInput:R(B),label:l.$t("organizations.inviteMember.usernameLabel"),placeholder:l.$t("organizations.inviteMember.usernamePlaceholder"),autocomplete:"off"},null,8,["modelValue","onInput","label","placeholder"]),j.value&&g.value.length>0?(v(),f("div",Fe,[(v(!0),f(E,null,U(g.value,w=>(v(),f("button",{key:w.id,type:"button",onClick:Ht=>s(w),class:"w-full px-4 py-3 text-left hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors flex items-center gap-3"},[e("div",Ae,r(w.username[0].toUpperCase()),1),e("div",Pe,[e("p",We,r(w.username),1),e("p",He,r(w.email),1)])],8,Re))),128))])):C("",!0),M.value?(v(),f("div",Ge,[I(a,{size:"sm"})])):C("",!0)]),d.value?(v(),f("div",Je,[e("div",Qe,[e("div",Xe,r(d.value.username[0].toUpperCase()),1),e("div",null,[e("p",qe,r(d.value.username),1),e("p",Ke,r(d.value.email),1)])]),e("button",{type:"button",onClick:m[1]||(m[1]=w=>d.value=null),class:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300"},m[3]||(m[3]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))])):C("",!0),x.value?(v(),f("div",Ye,r(x.value),1)):C("",!0),e("div",Ze,[I(_,{type:"button",variant:"ghost",onClick:u,disabled:k.value},{default:T(()=>[O(r(l.$t("common.cancel")),1)]),_:1},8,["disabled"]),I(_,{type:"submit",disabled:!d.value||k.value,loading:k.value},{default:T(()=>[O(r(l.$t("organizations.inviteMember.invite")),1)]),_:1},8,["disabled","loading"])])],32)]),_:1},8,["modelValue","title"])}}}),tt={class:"min-h-screen bg-gray-50 dark:bg-gray-950"},at={class:"container-lg py-8"},st={key:0,class:"space-y-6"},nt={key:1},ot={class:"flex items-start justify-between mb-8"},rt={class:"flex items-center gap-3 mb-2"},it={class:"w-16 h-16 bg-primary-500 rounded-xl flex items-center justify-center text-white font-bold text-2xl"},lt={class:"heading-1"},dt={class:"text-gray-600 dark:text-gray-400"},ct={class:"flex items-center gap-2"},ut={class:"grid grid-cols-1 sm:grid-cols-3 gap-4 mb-8"},mt={class:"card"},vt={class:"flex items-center justify-between"},gt={class:"text-sm text-gray-600 dark:text-gray-400"},ft={class:"text-2xl font-bold text-gray-900 dark:text-gray-100"},pt={class:"card"},yt={class:"flex items-center justify-between"},ht={class:"text-sm text-gray-600 dark:text-gray-400"},_t={class:"text-2xl font-bold text-gray-900 dark:text-gray-100"},bt={class:"card"},xt={class:"flex items-center justify-between"},kt={class:"text-sm text-gray-600 dark:text-gray-400"},wt={class:"text-lg font-medium text-gray-900 dark:text-gray-100"},zt={class:"border-b border-gray-200 dark:border-gray-800 mb-6"},$t={class:"flex space-x-8"},jt=["onClick"],Mt={key:0,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"},Ct={key:0,class:"col-span-full text-center py-12"},Tt={class:"text-gray-600 dark:text-gray-400"},St={class:"font-semibold text-gray-900 dark:text-gray-100 mb-2"},It={class:"text-sm text-gray-600 dark:text-gray-400 mb-4"},Ot={class:"flex items-center justify-between text-sm"},Vt={class:"text-gray-600 dark:text-gray-400"},Bt={class:"badge badge-primary"},Lt={key:1,class:"space-y-4"},Dt={class:"flex items-center gap-3"},Et={class:"w-10 h-10 bg-primary-500 rounded-full flex items-center justify-center text-white font-medium"},Ut={class:"font-medium text-gray-900 dark:text-gray-100"},Nt={class:"text-sm text-gray-600 dark:text-gray-400"},Ft={class:"flex items-center gap-2"},Rt=["onClick","title"],At={key:0,class:"mt-6"},Pt={key:2,class:"text-center py-12"},Wt={class:"text-gray-600 dark:text-gray-400"},aa=X({__name:"[id]",setup(t){const{t:i}=K(),y=ce(),{$rpc:p}=q(),$=me(),b=z(!1),o=z(null),c=z([]),g=z([]),d=z("rules"),M=z(!1),k=[{id:"rules",label:i("organizations.detail.rules")},{id:"members",label:i("organizations.detail.members")}],x=async()=>{b.value=!0;try{const s=y.params.id,n=await p.organizations.get({id:s});if(o.value=n,d.value==="rules"){const u=await p.organizations.rules({organizationId:s});c.value=u}if(d.value==="members"){const u=await p.organizations.members({organizationId:s});g.value=u}}catch(s){console.error("Failed to fetch organization details:",s),o.value=null}finally{b.value=!1}},j=async s=>{const n=y.params.id;try{if(s==="rules"&&c.value.length===0){const u=await p.organizations.rules({organizationId:n});c.value=u}else if(s==="members"&&g.value.length===0){const u=await p.organizations.members({organizationId:n});g.value=u}}catch(u){console.error(`Failed to fetch ${s}:`,u)}},V=async s=>{if(!(!o.value||!confirm(i("organizations.detail.confirmRemoveMember",{username:s.username}))))try{await p.organizations.removeMember({organizationId:o.value.id,userId:s.id}),g.value=g.value.filter(u=>u.id!==s.id),o.value&&o.value.memberCount--;const{showToast:n}=A();n({message:i("organizations.detail.memberRemoved",{username:s.username}),type:"success"})}catch(n){console.error("Failed to remove member:",n);const{showToast:u}=A();u({message:i("organizations.detail.removeMemberError"),type:"error"})}},B=s=>{d.value==="members"&&j("members")};return Y(d,s=>{j(s)}),Z(()=>{x()}),(s,n)=>{var h;const u=Q,l=ae,m=et;return v(),f("div",tt,[e("div",at,[b.value?(v(),f("div",st,n[2]||(n[2]=[ue('<div class="skeleton h-10 w-1/3"></div><div class="skeleton h-6 w-2/3"></div><div class="grid grid-cols-1 lg:grid-cols-3 gap-6"><div class="lg:col-span-2 space-y-6"><div class="card"><div class="skeleton h-6 w-1/4 mb-4"></div><div class="space-y-2"><div class="skeleton h-4 w-full"></div><div class="skeleton h-4 w-3/4"></div></div></div></div></div>',3)]))):o.value?(v(),f("div",nt,[e("div",ot,[e("div",null,[e("div",rt,[e("div",it,r(o.value.name[0].toUpperCase()),1),e("div",null,[e("h1",lt,r(o.value.name),1),e("p",dt,r(o.value.description||s.$t("organizations.noDescription")),1)])])]),e("div",ct,[o.value.role==="owner"?(v(),D(u,{key:0,variant:"ghost",size:"sm"},{default:T(()=>[n[3]||(n[3]=e("svg",{class:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})],-1)),O(" "+r(s.$t("organizations.detail.settings")),1)]),_:1,__:[3]})):C("",!0),o.value.role==="member"?(v(),D(u,{key:1,variant:"danger",size:"sm"},{default:T(()=>[O(r(s.$t("organizations.detail.leaveOrganization")),1)]),_:1})):C("",!0)])]),e("div",ut,[e("div",mt,[e("div",vt,[e("div",null,[e("p",gt,r(s.$t("organizations.detail.members")),1),e("p",ft,r(o.value.memberCount),1)]),n[4]||(n[4]=e("svg",{class:"w-8 h-8 text-primary-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"})],-1))])]),e("div",pt,[e("div",yt,[e("div",null,[e("p",ht,r(s.$t("organizations.detail.rules")),1),e("p",_t,r(o.value.ruleCount),1)]),n[5]||(n[5]=e("svg",{class:"w-8 h-8 text-primary-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1))])]),e("div",bt,[e("div",xt,[e("div",null,[e("p",kt,r(s.$t("organizations.detail.createdAt")),1),e("p",wt,r(new Date(o.value.createdAt).toLocaleDateString("ja-JP")),1)]),n[6]||(n[6]=e("svg",{class:"w-8 h-8 text-primary-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1))])])]),e("div",zt,[e("nav",$t,[(v(),f(E,null,U(k,a=>e("button",{key:a.id,onClick:_=>d.value=a.id,class:W(["py-2 px-1 border-b-2 font-medium text-sm transition-colors",d.value===a.id?"border-primary-500 text-primary-600 dark:text-primary-400":"border-transparent text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-100"])},r(a.label),11,jt)),64))])]),d.value==="rules"?(v(),f("div",Mt,[c.value.length===0?(v(),f("div",Ct,[e("p",Tt,r(s.$t("organizations.detail.noRules")),1)])):C("",!0),(v(!0),f(E,null,U(c.value,a=>(v(),D(l,{key:a.id,to:`/rules/@${o.value.name}/${a.name}`,class:"card-hover"},{default:T(()=>[e("h3",St,r(a.name),1),e("p",It,r(a.description),1),e("div",Ot,[e("span",Vt,r(new Date(a.updatedAt).toLocaleDateString("ja-JP")),1),e("span",Bt," v"+r(a.version),1)])]),_:2},1032,["to"]))),128))])):d.value==="members"?(v(),f("div",Lt,[(v(!0),f(E,null,U(g.value,a=>{var _;return v(),f("div",{key:a.id,class:"card flex items-center justify-between"},[e("div",Dt,[e("div",Et,r(a.username[0].toUpperCase()),1),e("div",null,[e("p",Ut,r(a.username),1),e("p",Nt,r(a.email),1)])]),e("div",Ft,[e("span",{class:W(["badge",a.role==="owner"?"badge-primary":"badge-gray"])},r(a.role==="owner"?s.$t("organizations.owner"):s.$t("organizations.member")),3),o.value.role==="owner"&&a.id!==((_=R($).user)==null?void 0:_.id)&&a.role!=="owner"?(v(),f("button",{key:0,onClick:S=>V(a),class:"text-gray-400 hover:text-red-600 dark:hover:text-red-400 transition-colors",title:s.$t("organizations.detail.removeMember")},n[7]||(n[7]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]),8,Rt)):C("",!0)])])}),128)),o.value.role==="owner"?(v(),f("div",At,[I(u,{onClick:n[0]||(n[0]=a=>M.value=!0),variant:"ghost",class:"w-full"},{default:T(()=>[n[8]||(n[8]=e("svg",{class:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z"})],-1)),O(" "+r(s.$t("organizations.detail.inviteMembers")),1)]),_:1,__:[8]})])):C("",!0)])):C("",!0)])):(v(),f("div",Pt,[e("p",Wt,r(s.$t("organizations.detail.notFound")),1),I(l,{to:"/organizations"},{default:T(()=>[I(u,{variant:"ghost",class:"mt-4"},{default:T(()=>[O(r(s.$t("organizations.detail.backToList")),1)]),_:1})]),_:1})]))]),I(m,{modelValue:M.value,"onUpdate:modelValue":n[1]||(n[1]=a=>M.value=a),"organization-id":((h=o.value)==null?void 0:h.id)||"",onInvited:B},null,8,["modelValue","organization-id"])])}}});export{aa as default};
