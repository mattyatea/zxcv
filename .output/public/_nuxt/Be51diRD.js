import{u as B,r as u,h as M,j as P,c as n,a as t,t as s,l as k,k as c,s as b,x as z,F as C,p as V,b as h,y as R,z as T,w as y,A as D,o as i,d as p,n as N}from"./CyjY5H8A.js";import{u as E}from"./6jrzLyMP.js";import{u as H}from"./BFNUtisj.js";const K={class:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8"},L={class:"mb-8"},W={class:"text-3xl font-bold text-gray-900 dark:text-white"},j={class:"mt-2 text-sm text-gray-600 dark:text-gray-400"},q={class:"card"},Z={class:"text-lg font-medium text-gray-900 dark:text-white mb-4"},G={class:"space-y-4"},J={for:"name",class:"label"},Q={class:"mt-1 text-xs text-gray-500 dark:text-gray-400"},X={for:"description",class:"label"},Y=["placeholder"],ee={for:"visibility",class:"label"},te={value:"public"},se={value:"private"},ae={for:"organization",class:"label"},le={value:""},oe=["value"],re={key:0,class:"mt-1 text-xs text-gray-500 dark:text-gray-400"},ne={class:"mt-1 text-xs text-gray-500 dark:text-gray-400"},ie={for:"tags",class:"label"},ue={class:"flex gap-2 mb-2"},de=["placeholder","onKeydown"],ce={class:"flex flex-wrap gap-2"},me=["onClick"],pe={class:"card"},ve={class:"text-lg font-medium text-gray-900 dark:text-white mb-4"},fe={class:"space-y-4"},ge={for:"content",class:"label"},be={class:"mb-2"},he={key:0,class:"mb-4"},ye=["placeholder"],xe={class:"mt-1 text-xs text-gray-500 dark:text-gray-400"},_e={class:"flex justify-end gap-4"},ke={key:0,class:"rounded-md bg-red-50 dark:bg-red-900/20 p-4"},$e={class:"text-sm text-red-800 dark:text-red-400"},Ne={__name:"new",setup(we){const{t:v}=B();H({title:v("rules.newRuleTitle")});const a=u({name:"",org:"",description:"",visibility:"public",organizationId:"",tags:[],content:""}),f=u(""),x=u([]),m=u(!1),d=u(""),_=u(""),g=u(!1),U=e=>{const l=e.target.files[0];if(l&&(l.name.endsWith(".md")||l.name.endsWith(".markdown"))){const r=new FileReader;r.onload=o=>{a.value.content=o.target.result},r.readAsText(l)}else d.value=v("rules.messages.invalidFileType")},$=()=>{const e=f.value.trim().toLowerCase();e&&!a.value.tags.includes(e)&&(a.value.tags.push(e),f.value="")},F=e=>{a.value.tags.splice(e,1)},I=()=>{const e=x.value.find(l=>l.id===_.value);e?(a.value.org=e.name,a.value.organizationId=e.id):(a.value.org="",a.value.organizationId="")},{$rpc:w}=M(),S=async()=>{var e;m.value=!0,d.value="";try{const l=await w.rules.create(a.value);if(a.value.org)await N(`/rules/@${a.value.org}/${a.value.name}`);else{const r=E();(e=r.user)!=null&&e.username?await N(`/rules/@${r.user.username}/${a.value.name}`):d.value=v("rules.messages.createError")}}catch(l){d.value=l.message||v("rules.messages.createError")}finally{m.value=!1}},O=async()=>{try{const e=await w.organizations.list();x.value=e}catch(e){console.error("Failed to fetch organizations:",e)}};return P(()=>{O()}),(e,l)=>{const r=D("Button");return i(),n("div",K,[t("div",L,[t("h1",W,s(e.$t("rules.createNewRule")),1),t("p",j,s(e.$t("rules.shareWithCommunity")),1)]),t("form",{onSubmit:T(S,["prevent"]),class:"space-y-6"},[t("div",q,[t("h2",Z,s(e.$t("rules.basicInfo")),1),t("div",G,[t("div",null,[t("label",J,s(e.$t("rules.form.name")),1),c(t("input",{id:"name","onUpdate:modelValue":l[0]||(l[0]=o=>a.value.name=o),type:"text",required:"",pattern:"[a-zA-Z0-9_-]+",class:"input",placeholder:"my-awesome-rule"},null,512),[[b,a.value.name]]),t("p",Q,s(e.$t("rules.form.nameHint")),1)]),t("div",null,[t("label",X,s(e.$t("rules.form.description")),1),c(t("textarea",{id:"description","onUpdate:modelValue":l[1]||(l[1]=o=>a.value.description=o),rows:"3",class:"input",placeholder:e.$t("rules.form.descriptionPlaceholder")},null,8,Y),[[b,a.value.description]])]),t("div",null,[t("label",ee,s(e.$t("rules.form.visibility")),1),c(t("select",{id:"visibility","onUpdate:modelValue":l[2]||(l[2]=o=>a.value.visibility=o),class:"input"},[t("option",te,s(e.$t("rules.form.visibilityOptions.public")),1),t("option",se,s(e.$t("rules.form.visibilityOptions.private")),1)],512),[[z,a.value.visibility]])]),t("div",null,[t("label",ae,s(e.$t("rules.form.organization"))+" ("+s(e.$t("common.optional"))+")",1),c(t("select",{id:"organization","onUpdate:modelValue":l[3]||(l[3]=o=>_.value=o),class:"input",onChange:I},[t("option",le,s(e.$t("rules.form.noOrganization")),1),(i(!0),n(C,null,V(x.value,o=>(i(),n("option",{key:o.id,value:o.id},s(o.displayName),9,oe))),128))],544),[[z,_.value]]),a.value.org?(i(),n("p",re,s(e.$t("rules.form.urlPreview"))+" @"+s(a.value.org)+"/"+s(a.value.name||"rule-name"),1)):k("",!0),t("p",ne,s(e.$t("rules.form.organizationHint")),1)]),t("div",null,[t("label",ie,s(e.$t("rules.form.tags")),1),t("div",ue,[c(t("input",{"onUpdate:modelValue":l[4]||(l[4]=o=>f.value=o),type:"text",class:"input flex-1",placeholder:e.$t("rules.form.tagsPlaceholder"),onKeydown:R(T($,["prevent"]),["enter"])},null,40,de),[[b,f.value]]),h(r,{type:"button",onClick:$,variant:"secondary",size:"sm"},{default:y(()=>[p(s(e.$t("rules.form.addTag")),1)]),_:1})]),t("div",ce,[(i(!0),n(C,null,V(a.value.tags,(o,A)=>(i(),n("span",{key:o,class:"inline-flex items-center px-3 py-1 rounded-full text-sm bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200"},[p(s(o)+" ",1),t("button",{type:"button",onClick:ze=>F(A),class:"ml-2 text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-200"}," Ã— ",8,me)]))),128))])])])]),t("div",pe,[t("h2",ve,s(e.$t("rules.ruleContent")),1),t("div",fe,[t("div",null,[t("label",ge,s(e.$t("rules.form.content")),1),t("div",be,[h(r,{type:"button",onClick:l[5]||(l[5]=o=>g.value=!g.value),variant:"ghost",size:"sm"},{default:y(()=>[p(s(g.value?e.$t("rules.form.writeDirectly"):e.$t("rules.form.uploadMarkdown")),1)]),_:1})]),g.value?(i(),n("div",he,[t("input",{type:"file",accept:".md,.markdown",onChange:U,class:"block w-full text-sm text-gray-500 dark:text-gray-400 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 dark:file:bg-blue-900 dark:file:text-blue-200 hover:file:bg-blue-100 dark:hover:file:bg-blue-800"},null,32)])):k("",!0),c(t("textarea",{id:"content","onUpdate:modelValue":l[6]||(l[6]=o=>a.value.content=o),rows:"15",required:"",class:"input font-mono text-sm",placeholder:e.$t("rules.form.contentPlaceholder")},null,8,ye),[[b,a.value.content]]),t("p",xe,s(e.$t("rules.form.markdownSupported")),1)])])]),t("div",_e,[h(r,{tag:e.NuxtLink,to:"/rules",variant:"secondary"},{default:y(()=>[p(s(e.$t("common.cancel")),1)]),_:1},8,["tag"]),h(r,{type:"submit",loading:m.value,disabled:m.value,variant:"primary"},{default:y(()=>[p(s(m.value?e.$t("rules.creating"):e.$t("rules.createRule")),1)]),_:1},8,["loading","disabled"])]),d.value?(i(),n("div",ke,[t("p",$e,s(d.value),1)])):k("",!0)],32)])}}};export{Ne as default};
