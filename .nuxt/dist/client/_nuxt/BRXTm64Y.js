import{_ as te}from"./oZfRzh-Q.js";import{_ as oe}from"./CdYq105T.js";import{g as Q,m as M,c as d,o as n,q as le,l as x,H as Y,B as ne,I as de,a,h as ie,G as ue,r as m,j as ce,b as v,t,w as f,d as b,f as o,F as me,p as pe,J as ve,z as Z}from"./CyjY5H8A.js";import{_ as fe}from"./DlAUqK2U.js";import{_ as ge}from"./9Izdmuga.js";import{_ as we}from"./BvTw6xzz.js";import{u as K}from"./JGZA2kR1.js";import{u as he}from"./6jrzLyMP.js";import"./CLdyUvtB.js";const be={key:0,class:"badge-icon"},xe={key:0,class:"badge-dot"},ye=Q({__name:"Badge",props:{variant:{default:"gray"},size:{default:"sm"},rounded:{default:"full"},closable:{type:Boolean,default:!1},icon:{},dot:{type:Boolean,default:!1}},emits:["close"],setup(H){const P=H,C=M(()=>{const e="badge inline-flex items-center font-medium transition-all duration-200",g={primary:"badge-primary",success:"badge-success",warning:"badge-warning",danger:"badge-danger",info:"badge-info",gray:"badge-gray"},V={xs:"text-xs px-2 py-0.5",sm:"text-xs px-2.5 py-0.5",md:"text-sm px-3 py-1",lg:"text-base px-4 py-1.5"},$={md:"rounded-md",lg:"rounded-lg",full:"rounded-full"};return[e,g[P.variant],V[P.size],$[P.rounded]].join(" ")});return(e,g)=>(n(),d("span",{class:le(C.value)},[e.$slots.icon||e.icon||e.dot?(n(),d("span",be,[e.dot?(n(),d("span",xe)):Y(e.$slots,"icon",{key:1},()=>[e.icon?(n(),ne(de(e.icon),{key:0})):x("",!0)],!0)])):x("",!0),Y(e.$slots,"default",{},void 0,!0),e.closable?(n(),d("button",{key:1,type:"button",onClick:g[0]||(g[0]=V=>e.$emit("close")),class:"badge-close"},g[1]||(g[1]=[a("svg",{class:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))):x("",!0)],2))}}),_e=fe(ye,[["__scopeId","data-v-bb0bdee7"]]),ke={class:"container mx-auto max-w-4xl px-4 py-8"},Pe={key:0,class:"flex justify-center items-center min-h-[400px]"},Ce={key:1,class:"text-center py-8"},Ve={class:"text-red-600 mb-4"},$e={key:2},ze={class:"bg-white dark:bg-gray-800 rounded-lg shadow-md dark:shadow-gray-900/50 p-6 mb-6"},Be={class:"flex items-start justify-between"},Fe={class:"flex items-center space-x-4"},Ue={class:"w-24 h-24 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center text-white text-3xl font-bold"},Ae={class:"text-2xl font-bold text-gray-900 dark:text-white"},Ee={class:"text-gray-600 dark:text-gray-400"},je={class:"flex items-center mt-2"},Me={key:0,class:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-400"},Ne={key:1,class:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 dark:bg-yellow-900/30 text-yellow-800 dark:text-yellow-400"},Se={class:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-6"},qe={class:"bg-white dark:bg-gray-800 rounded-lg shadow-md dark:shadow-gray-900/50 p-6"},De={class:"text-lg font-semibold text-gray-900 dark:text-white mb-2"},He={class:"text-3xl font-bold text-blue-600"},Ie={class:"bg-white dark:bg-gray-800 rounded-lg shadow-md dark:shadow-gray-900/50 p-6"},Le={class:"text-lg font-semibold text-gray-900 dark:text-white mb-2"},Re={class:"text-3xl font-bold text-green-600"},Te={class:"bg-white dark:bg-gray-800 rounded-lg shadow-md dark:shadow-gray-900/50 p-6"},Oe={class:"text-lg font-semibold text-gray-900 dark:text-white mb-2"},Je={class:"text-lg text-gray-600 dark:text-gray-400"},Ge={class:"bg-white dark:bg-gray-800 rounded-lg shadow-md dark:shadow-gray-900/50 p-6"},We={class:"text-xl font-bold text-gray-900 dark:text-white mb-4"},Ye={key:0,class:"space-y-4"},Ze={class:"flex justify-between items-start"},Ke={class:"text-sm text-gray-600 dark:text-gray-400 mt-1"},Qe={class:"text-sm text-gray-500 dark:text-gray-500"},Xe={key:1,class:"text-gray-500 dark:text-gray-400 text-center py-8"},ea={class:"flex flex-col items-center mb-6"},aa={class:"relative"},sa={class:"w-24 h-24 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center text-white text-3xl font-bold"},ra=["title"],ta={class:"text-sm text-gray-500 dark:text-gray-400 mt-2"},oa={class:"text-xs text-gray-500 dark:text-gray-400 mt-1"},la={key:0,class:"mt-2"},na={class:"pt-4 border-t border-gray-200 dark:border-gray-700"},da={key:0,class:"p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-md"},ia={class:"text-sm text-red-600 dark:text-red-400"},ua={class:"flex justify-end space-x-3 pt-4"},ca={class:"text-xs text-gray-500 dark:text-gray-400 mt-1"},ma={key:0,class:"p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-md"},pa={class:"text-sm text-red-600 dark:text-red-400"},va={class:"flex justify-end space-x-3 pt-4"},Pa=Q({__name:"[username]",setup(H){const P=ve(),{$rpc:C,$t:e}=ie(),g=he(),{user:V}=ue(g),$=m(!0),z=m(null),i=m(null),N=m({rulesCount:0,organizationsCount:0}),S=m([]),B=m(!1),A=m(!1),y=m(null),u=m({username:"",email:""}),c=m({}),_=m(!1),E=m(!1),k=m(null),p=m({currentPassword:"",newPassword:"",confirmPassword:""}),w=m({}),X=m(!1),q=M(()=>{var r,s;return((r=V.value)==null?void 0:r.id)===((s=i.value)==null?void 0:s.id)}),D=M(()=>{const r=u.value.username.trim().length>0,s=u.value.email.trim().length>0,h=!c.value.username&&!c.value.email;return r&&s&&h}),I=M(()=>p.value.currentPassword.length>0&&p.value.newPassword.length>=8&&p.value.confirmPassword.length>0&&Object.keys(w.value).length===0),L=r=>new Date(r*1e3).toLocaleDateString("ja-JP",{year:"numeric",month:"long",day:"numeric"}),ee=async()=>{var r;try{$.value=!0,z.value=null;const s=P.params.username||((r=V.value)==null?void 0:r.username);if(!s){z.value=e("profile.errors.noUsername");return}const h=await C.users.getProfile({username:s});i.value=h.user,N.value=h.stats,S.value=h.recentRules||[],q.value&&i.value&&(u.value={username:i.value.username,email:i.value.email},c.value={})}catch(s){console.error("Failed to load profile:",s),z.value=s instanceof Error?s.message:e("profile.errors.loadFailed")}finally{$.value=!1}},R=()=>{c.value.username="";const r=u.value.username.trim();r?/^[a-zA-Z0-9_-]+$/.test(r)?r.length<3&&(c.value.username=e("profile.errors.usernameMinLength")):c.value.username=e("profile.errors.usernameInvalid"):c.value.username=e("profile.errors.usernameRequired")},T=()=>{c.value.email="";const r=u.value.email.trim();r?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(r)||(c.value.email=e("profile.errors.emailInvalid")):c.value.email=e("profile.errors.emailRequired")},O=()=>{w.value.newPassword="",p.value.newPassword.length<8&&(w.value.newPassword=e("profile.errors.passwordMinLength"))},J=()=>{w.value.confirmPassword="",p.value.newPassword!==p.value.confirmPassword&&(w.value.confirmPassword=e("profile.errors.passwordMismatch"))},ae=async()=>{console.log("updateProfile called"),console.log("isFormValid:",D.value),console.log("editForm:",u.value),console.log("errors:",c.value);try{if(A.value=!0,y.value=null,R(),T(),!D.value){console.log("Form is invalid, returning");return}console.log("Calling API with:",{username:u.value.username.trim(),email:u.value.email.trim()});const r=await C.users.updateProfile({username:u.value.username.trim(),email:u.value.email.trim()});console.log("API response:",r),i.value=r.user,B.value=!1,q.value&&await g.updateUser(r.user);const{success:s}=K();s(e("profile.success.profileUpdated"))}catch(r){console.error("Failed to update profile:",r),r instanceof Error?r.message.includes("already in use")?y.value=e("profile.errors.usernameOrEmailTaken"):y.value=r.message||e("profile.errors.updateFailed"):y.value=e("profile.errors.updateFailed")}finally{A.value=!1}},G=()=>{B.value=!1,y.value=null,c.value={},i.value&&(u.value={username:i.value.username,email:i.value.email}),console.log("cancelEdit - errors cleared:",c.value)},se=async()=>{try{if(E.value=!0,k.value=null,O(),J(),!I.value)return;await C.users.changePassword({currentPassword:p.value.currentPassword,newPassword:p.value.newPassword}),p.value={currentPassword:"",newPassword:"",confirmPassword:""},w.value={},_.value=!1;const{success:r}=K();r(e("profile.success.passwordChanged"))}catch(r){console.error("Failed to change password:",r),r instanceof Error?r.message.includes("incorrect")||r.message.includes("wrong")?k.value=e("profile.errors.wrongCurrentPassword"):k.value=r.message||e("profile.errors.passwordChangeFailed"):k.value=e("profile.errors.passwordChangeFailed")}finally{E.value=!1}};return ce(()=>{ee()}),(r,s)=>{const h=te,F=oe,re=_e,j=ge,W=we;return n(),d("div",ke,[$.value?(n(),d("div",Pe,s[12]||(s[12]=[a("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"},null,-1)]))):z.value?(n(),d("div",Ce,[a("p",Ve,t(z.value),1),v(h,{to:"/",class:"text-blue-600 hover:underline"},{default:f(()=>[b(t(o(e)("profile.backToHome")),1)]),_:1})])):i.value?(n(),d("div",$e,[a("div",ze,[a("div",Be,[a("div",Fe,[a("div",Ue,t(i.value.username.charAt(0).toUpperCase()),1),a("div",null,[a("h1",Ae,t(i.value.username),1),a("p",Ee,t(i.value.email),1),a("div",je,[i.value.emailVerified?(n(),d("span",Me,[s[13]||(s[13]=a("svg",{class:"w-3 h-3 mr-1",fill:"currentColor",viewBox:"0 0 20 20"},[a("path",{"fill-rule":"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z","clip-rule":"evenodd"})],-1)),b(" "+t(o(e)("profile.emailVerified")),1)])):(n(),d("span",Ne,t(o(e)("profile.emailNotVerified")),1))])])]),q.value?(n(),d("button",{key:0,onClick:s[0]||(s[0]=()=>{console.log("Edit button clicked"),c.value.value={},B.value=!0}),class:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors"},t(o(e)("profile.editProfile")),1)):x("",!0)])]),a("div",Se,[a("div",qe,[a("h3",De,t(o(e)("profile.createdRules")),1),a("p",He,t(N.value.rulesCount||0),1)]),a("div",Ie,[a("h3",Le,t(o(e)("profile.belongingOrganizations")),1),a("p",Re,t(N.value.organizationsCount||0),1)]),a("div",Te,[a("h3",Oe,t(o(e)("profile.registrationDate")),1),a("p",Je,t(L(i.value.createdAt)),1)])]),a("div",Ge,[a("h2",We,t(o(e)("profile.recentActivity")),1),S.value.length>0?(n(),d("div",Ye,[(n(!0),d(me,null,pe(S.value,l=>(n(),d("div",{key:l.id,class:"border-b border-gray-200 dark:border-gray-700 pb-4 last:border-0"},[a("div",Ze,[a("div",null,[v(h,{to:l.organization?`/rules/@${l.organization.name}/${l.name}`:`/rules/@${i.value.username}/${l.name}`,class:"text-lg font-medium text-blue-600 hover:underline"},{default:f(()=>[b(t(l.name),1)]),_:2},1032,["to"]),a("p",Ke,t(l.description),1)]),a("span",Qe,t(L(l.updatedAt)),1)])]))),128))])):(n(),d("div",Xe,t(o(e)("profile.noActivityYet")),1))])])):x("",!0),v(W,{modelValue:B.value,"onUpdate:modelValue":s[5]||(s[5]=l=>B.value=l),title:o(e)("profile.editProfile"),onClose:G},{default:f(()=>{var l;return[a("form",{onSubmit:Z(ae,["prevent"]),class:"space-y-4"},[a("div",ea,[a("div",aa,[a("div",sa,t(u.value.username.charAt(0).toUpperCase()),1),a("button",{type:"button",class:"absolute bottom-0 right-0 p-2 bg-white dark:bg-gray-700 rounded-full shadow-lg hover:bg-gray-50 dark:hover:bg-gray-600 transition-colors",onClick:s[1]||(s[1]=U=>X.value=!0),title:o(e)("profile.changeAvatar")},s[14]||(s[14]=[a("svg",{class:"w-4 h-4 text-gray-600 dark:text-gray-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"}),a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 13a3 3 0 11-6 0 3 3 0 016 0z"})],-1)]),8,ra)]),a("p",ta,t(o(e)("profile.avatarChangeComingSoon")),1)]),a("div",null,[v(F,{modelValue:u.value.username,"onUpdate:modelValue":s[2]||(s[2]=U=>u.value.username=U),label:o(e)("profile.username"),placeholder:o(e)("profile.placeholders.username"),error:c.value.username,required:"",onBlur:R},{hint:f(()=>[a("p",oa,t(o(e)("profile.usernameHint")),1)]),_:1},8,["modelValue","label","placeholder","error"])]),a("div",null,[v(F,{modelValue:u.value.email,"onUpdate:modelValue":s[3]||(s[3]=U=>u.value.email=U),type:"email",label:o(e)("profile.email"),placeholder:o(e)("profile.placeholders.email"),error:c.value.email,required:"",onBlur:T},null,8,["modelValue","label","placeholder","error"]),u.value.email!==((l=i.value)==null?void 0:l.email)?(n(),d("div",la,[v(re,{variant:"warning",size:"sm"},{default:f(()=>[s[15]||(s[15]=a("svg",{class:"w-3 h-3 mr-1",fill:"currentColor",viewBox:"0 0 20 20"},[a("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z","clip-rule":"evenodd"})],-1)),b(" "+t(o(e)("profile.emailChangeWarning")),1)]),_:1,__:[15]})])):x("",!0)]),a("div",na,[a("button",{type:"button",onClick:s[4]||(s[4]=U=>_.value=!0),class:"text-sm text-blue-600 dark:text-blue-400 hover:text-blue-700 dark:hover:text-blue-300 font-medium"},t(o(e)("profile.changePassword")),1)]),y.value?(n(),d("div",da,[a("p",ia,t(y.value),1)])):x("",!0),a("div",ua,[v(j,{type:"button",variant:"secondary",onClick:G},{default:f(()=>[b(t(o(e)("common.cancel")),1)]),_:1}),v(j,{type:"submit",loading:A.value,disabled:!D.value||A.value},{default:f(()=>[b(t(o(e)("profile.update")),1)]),_:1},8,["loading","disabled"])])],32)]}),_:1},8,["modelValue","title"]),v(W,{modelValue:_.value,"onUpdate:modelValue":s[10]||(s[10]=l=>_.value=l),title:o(e)("profile.changePassword"),onClose:s[11]||(s[11]=l=>_.value=!1)},{default:f(()=>[a("form",{onSubmit:Z(se,["prevent"]),class:"space-y-4"},[v(F,{modelValue:p.value.currentPassword,"onUpdate:modelValue":s[6]||(s[6]=l=>p.value.currentPassword=l),type:"password",label:o(e)("profile.currentPassword"),placeholder:o(e)("profile.placeholders.currentPassword"),error:w.value.currentPassword,required:""},null,8,["modelValue","label","placeholder","error"]),v(F,{modelValue:p.value.newPassword,"onUpdate:modelValue":s[7]||(s[7]=l=>p.value.newPassword=l),type:"password",label:o(e)("profile.newPassword"),placeholder:o(e)("profile.placeholders.newPassword"),error:w.value.newPassword,required:"",onBlur:O},{hint:f(()=>[a("p",ca,t(o(e)("profile.passwordHint")),1)]),_:1},8,["modelValue","label","placeholder","error"]),v(F,{modelValue:p.value.confirmPassword,"onUpdate:modelValue":s[8]||(s[8]=l=>p.value.confirmPassword=l),type:"password",label:o(e)("profile.newPasswordConfirm"),placeholder:o(e)("profile.placeholders.newPasswordConfirm"),error:w.value.confirmPassword,required:"",onBlur:J},null,8,["modelValue","label","placeholder","error"]),k.value?(n(),d("div",ma,[a("p",pa,t(k.value),1)])):x("",!0),a("div",va,[v(j,{type:"button",variant:"secondary",onClick:s[9]||(s[9]=l=>_.value=!1)},{default:f(()=>[b(t(o(e)("common.cancel")),1)]),_:1}),v(j,{type:"submit",loading:E.value,disabled:!I.value||E.value},{default:f(()=>[b(t(o(e)("profile.change")),1)]),_:1},8,["loading","disabled"])])],32)]),_:1},8,["modelValue","title"])])}}});export{Pa as default};
