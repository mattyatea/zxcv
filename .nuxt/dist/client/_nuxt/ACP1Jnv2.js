import{_ as X}from"./9Izdmuga.js";import{_ as Y}from"./oZfRzh-Q.js";import{_ as Z}from"./BvTw6xzz.js";import{g as ee,C as te,h as se,u as O,K as ae,r as c,G as oe,m as U,j as re,c as d,a as e,b as v,e as ne,l as p,t as s,d as g,q as le,B as M,w as u,F,p as R,O as ie,o as i}from"./CyjY5H8A.js";import{u as de}from"./JGZA2kR1.js";import{u as ue}from"./6jrzLyMP.js";import"./DlAUqK2U.js";import"./CLdyUvtB.js";const ce={class:"min-h-screen bg-gray-50 dark:bg-gray-950"},ve={class:"container-lg py-8"},ge={key:0,class:"max-w-4xl mx-auto"},me={key:1,class:"max-w-4xl mx-auto"},he={class:"mb-8"},pe={class:"flex items-start justify-between gap-4"},ye={class:"heading-1 mb-3"},_e={class:"flex items-center gap-4 text-sm text-gray-600 dark:text-gray-400"},fe={class:"flex items-center"},ke={class:"flex items-center gap-2"},xe={key:0,class:"card mb-6"},we={class:"text-lg font-semibold text-gray-900 dark:text-gray-100 mb-3"},be={class:"text-gray-600 dark:text-gray-400"},$e={key:1,class:"mb-6"},ze={class:"flex items-center gap-2"},Ce={class:"flex flex-wrap gap-2"},Ve={key:2,class:"mb-6 p-4 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg"},je={class:"flex items-center justify-between"},Be={class:"text-sm text-yellow-800 dark:text-yellow-200"},De={class:"card mb-6"},Me={class:"flex items-center justify-between mb-4"},Fe={class:"text-lg font-semibold text-gray-900 dark:text-gray-100"},Re={class:"relative"},Se={class:"bg-gray-900 text-gray-100 p-4 rounded-lg overflow-x-auto"},Te={class:"card"},Le={class:"text-lg font-semibold text-gray-900 dark:text-gray-100 mb-4"},Ee={class:"space-y-3"},He=["onClick"],Ae={class:"flex-1"},Ne={class:"font-medium text-gray-900 dark:text-gray-100 group-hover:text-blue-600 dark:group-hover:text-blue-400 transition-colors"},Oe={key:0,class:"ml-2 text-xs text-green-600 dark:text-green-400"},Ue={class:"text-sm text-gray-600 dark:text-gray-400 ml-3"},qe={class:"flex items-center gap-3"},Ge={class:"text-sm text-gray-600 dark:text-gray-400"},Ie={key:0,class:"text-xs text-blue-600 dark:text-blue-400 font-medium"},Je={key:3,class:"mt-8"},Ke={class:"text-xl font-semibold text-gray-900 dark:text-gray-100 mb-4"},Pe={class:"grid grid-cols-1 sm:grid-cols-2 gap-4"},Qe={class:"font-medium text-gray-900 dark:text-gray-100 mb-1"},We={class:"text-sm text-gray-600 dark:text-gray-400"},Xe={key:2,class:"text-center py-12"},Ye={class:"text-gray-600 dark:text-gray-400"},Ze={class:"text-gray-600 dark:text-gray-400"},dt=ee({__name:"index",setup(et){const S=te(),{$rpc:m}=se(),{t:h}=O(),q=ae(),k=c(!1),r=c(null),T=c([]),$=c([]),_=c(!1),z=c(!1),C=c(""),G=ue(),{user:L}=oe(G),{success:w,error:b}=de(),x=c(!1),V=c(!1),f=ie("customRouteParams",null),j=U(()=>(f==null?void 0:f.owner)||S.params.owner),B=U(()=>(f==null?void 0:f.name)||S.params.name),E=async()=>{var t;k.value=!0;try{const a=`@${j.value}/${B.value}`,o=await m.rules.getByPath({path:a}),y=await m.rules.getContent({id:o.id});if(r.value={id:o.id,name:o.name,description:o.description||"",content:y.content,visibility:o.visibility,author:o.author,organization:o.organization,tags:o.tags||[],version:o.version,updated_at:typeof o.updated_at=="number"?o.updated_at:Math.floor(new Date(o.updated_at).getTime()/1e3)},((t=L.value)==null?void 0:t.id)===o.author.id)_.value=!0;else if(o.organization)try{const n=(await m.organizations.list()).some(D=>{var A,N;return D.id===((A=o.organization)==null?void 0:A.id)&&D.owner.id===((N=L.value)==null?void 0:N.id)});_.value=n}catch(l){console.error("Failed to check organization ownership:",l),_.value=!1}else _.value=!1;C.value=o.version;try{const l=await m.rules.versions({id:o.id});T.value=l}catch(l){console.error("Failed to fetch versions:",l)}try{const l=await m.rules.related({id:o.id});$.value=l}catch(l){console.error("Failed to fetch related rules:",l)}}catch(a){console.error("Failed to fetch rule details:",a),r.value=null}finally{k.value=!1}},{locale:I}=O(),H=t=>new Date(t*1e3).toLocaleDateString(I.value==="ja"?"ja-JP":"en-US"),J=async()=>{if(r.value)try{await navigator.clipboard.writeText(r.value.content),z.value=!0,w(h("rules.messages.copied")),setTimeout(()=>{z.value=!1},2e3)}catch(t){console.error("Failed to copy:",t),b(h("rules.messages.copyError"))}},K=async()=>{if(r.value)try{await navigator.clipboard.writeText(r.value.content),w(h("rules.messages.contentCopied"))}catch(t){console.error("Failed to copy content:",t),b(h("rules.messages.copyError"))}},P=t=>t.organization?`/rules/@${t.organization.name}/${t.name}`:`/rules/@${t.author.username}/${t.name}`,Q=async t=>{console.log("Showing version:",t),k.value=!0;try{const a=`@${j.value}/${B.value}`,y=(await m.rules.getByPath({path:a})).id,l=await m.rules.getVersion({id:y,version:t});r.value={id:l.id,name:l.name,description:l.description||"",content:l.content,visibility:l.visibility,author:l.author,organization:l.organization,tags:l.tags,version:l.version,updated_at:l.createdAt},w(h("rules.messages.viewingVersion",{version:`v${t}`}))}catch(a){console.error("Failed to fetch version:",a),b(h("rules.messages.versionFetchError"))}finally{k.value=!1}},W=async()=>{if(r.value){V.value=!0;try{await m.rules.delete({id:r.value.id}),x.value=!1,w(h("rules.messages.deleted")),await q.push("/rules")}catch(t){console.error("Failed to delete rule:",t),b(h("rules.messages.deleteError"))}finally{V.value=!1}}};return re(()=>{E()}),(t,a)=>{const o=X,y=Y,l=Z;return i(),d("div",ce,[e("div",ve,[k.value?(i(),d("div",ge,a[3]||(a[3]=[ne('<div class="skeleton h-10 w-2/3 mb-4"></div><div class="skeleton h-6 w-1/3 mb-8"></div><div class="card"><div class="skeleton h-4 w-full mb-2"></div><div class="skeleton h-4 w-3/4 mb-2"></div><div class="skeleton h-4 w-1/2"></div></div>',3)]))):r.value?(i(),d("div",me,[e("div",he,[e("div",pe,[e("div",null,[e("h1",ye,s(r.value.name),1),e("div",_e,[e("span",fe,[a[4]||(a[4]=e("svg",{class:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})],-1)),g(" "+s(r.value.author.username),1)]),e("span",null,"v"+s(r.value.version),1),e("span",null,s(H(r.value.updated_at)),1),e("span",{class:le(["px-2 py-1 text-xs rounded-full",r.value.visibility==="public"?"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300":r.value.visibility==="private"?"bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-300":"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300"])},s(t.$t(`rules.visibility.${r.value.visibility}`)),3)])]),e("div",ke,[_.value?(i(),M(y,{key:0,to:`/rules/@${j.value}/${B.value}/edit`},{default:u(()=>[v(o,{variant:"ghost",size:"sm"},{default:u(()=>[a[5]||(a[5]=e("svg",{class:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})],-1)),g(" "+s(t.$t("rules.actions.edit")),1)]),_:1,__:[5]})]),_:1},8,["to"])):p("",!0),_.value?(i(),M(o,{key:1,variant:"danger",size:"sm",onClick:a[0]||(a[0]=n=>x.value=!0)},{default:u(()=>[a[6]||(a[6]=e("svg",{class:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)),g(" "+s(t.$t("rules.actions.delete")),1)]),_:1,__:[6]})):p("",!0),v(o,{variant:"primary",size:"sm",onClick:J},{default:u(()=>[a[7]||(a[7]=e("svg",{class:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})],-1)),g(" "+s(z.value?t.$t("rules.actions.copied"):t.$t("rules.actions.copyRule")),1)]),_:1,__:[7]})])])]),r.value.description?(i(),d("div",xe,[e("h2",we,s(t.$t("rules.form.description")),1),e("p",be,s(r.value.description),1)])):p("",!0),r.value.tags&&r.value.tags.length>0?(i(),d("div",$e,[e("div",ze,[a[8]||(a[8]=e("svg",{class:"w-5 h-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"})],-1)),e("div",Ce,[(i(!0),d(F,null,R(r.value.tags,n=>(i(),d("span",{key:n,class:"px-3 py-1 text-sm bg-gray-100 text-gray-700 dark:bg-gray-800 dark:text-gray-300 rounded-full"},s(n),1))),128))])])])):p("",!0),r.value.version!==C.value?(i(),d("div",Ve,[e("div",je,[e("p",Be,s(t.$t("rules.detail.viewingOldVersion",{version:`v${r.value.version}`})),1),v(o,{size:"sm",variant:"primary",onClick:E},{default:u(()=>[g(s(t.$t("rules.detail.viewLatestVersion")),1)]),_:1})])])):p("",!0),e("div",De,[e("div",Me,[e("h2",Fe,s(t.$t("rules.ruleContent")),1),v(o,{variant:"ghost",size:"xs",onClick:K},{default:u(()=>a[9]||(a[9]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})],-1)])),_:1,__:[9]})]),e("div",Re,[e("pre",Se,[e("code",null,s(r.value.content),1)])])]),e("div",Te,[e("h2",Le,s(t.$t("rules.detail.versionHistory")),1),e("div",Ee,[(i(!0),d(F,null,R(T.value,n=>(i(),d("div",{key:n.version,class:"group flex items-center justify-between p-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors cursor-pointer",onClick:D=>n.version!==r.value.version&&Q(n.version)},[e("div",Ae,[e("span",Ne,[g(" v"+s(n.version)+" ",1),n.version===C.value?(i(),d("span",Oe," ("+s(t.$t("rules.detail.latest"))+") ",1)):p("",!0)]),e("span",Ue,s(n.changelog),1)]),e("div",qe,[e("span",Ge,s(H(n.created_at)),1),n.version===r.value.version?(i(),d("span",Ie,s(t.$t("rules.detail.currentlyViewing")),1)):p("",!0)])],8,He))),128))])]),$.value.length>0?(i(),d("div",Je,[e("h2",Ke,s(t.$t("rules.detail.relatedRules")),1),e("div",Pe,[(i(!0),d(F,null,R($.value,n=>(i(),M(y,{key:n.id,to:P(n),class:"card-hover"},{default:u(()=>[e("h3",Qe,s(n.name),1),e("p",We,"by "+s(n.organization?"@"+n.organization.name:n.author.username),1)]),_:2},1032,["to"]))),128))])])):p("",!0)])):(i(),d("div",Xe,[e("p",Ye,s(t.$t("rules.detail.notFound")),1),v(y,{to:"/rules"},{default:u(()=>[v(o,{variant:"ghost",class:"mt-4"},{default:u(()=>[g(s(t.$t("rules.detail.backToList")),1)]),_:1})]),_:1})]))]),v(l,{modelValue:x.value,"onUpdate:modelValue":a[2]||(a[2]=n=>x.value=n),title:t.$t("rules.messages.deleteConfirm"),size:"sm"},{footer:u(()=>[v(o,{variant:"ghost",onClick:a[1]||(a[1]=n=>x.value=!1)},{default:u(()=>[g(s(t.$t("common.cancel")),1)]),_:1}),v(o,{variant:"danger",onClick:W,loading:V.value},{default:u(()=>[g(s(t.$t("common.delete")),1)]),_:1},8,["loading"])]),default:u(()=>[e("p",Ze,s(t.$t("rules.messages.deleteConfirm")),1)]),_:1},8,["modelValue","title"])])}}});export{dt as default};
