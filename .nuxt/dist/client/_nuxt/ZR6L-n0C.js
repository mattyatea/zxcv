import{_ as O}from"./BRXEsc8B.js";import{_ as D}from"./9Izdmuga.js";import{_ as R}from"./BnZv6PoX.js";import{g as z,C as G,K as H,h as L,m as b,r as p,j as q,c as f,a as t,b as g,w as _,o as v,l as F,f as r,t as h,n as C,d as T}from"./CyjY5H8A.js";import{u as I}from"./JGZA2kR1.js";import{u as J}from"./6jrzLyMP.js";import{u as K}from"./BFNUtisj.js";import{_ as U}from"./DlAUqK2U.js";import"./CLdyUvtB.js";const X={class:"min-h-screen flex items-center justify-center bg-gray-50 dark:bg-gray-900"},Z={class:"max-w-md w-full px-4"},P={key:0,class:"space-y-4"},Q={class:"text-gray-600 dark:text-gray-400"},W={key:1,class:"space-y-4"},Y={class:"text-gray-600 dark:text-gray-400"},ee={class:"flex flex-col sm:flex-row gap-3 justify-center mt-6"},te={key:2,class:"space-y-4"},se=z({__name:"[provider]",setup(oe){const k=G(),j=H(),{$rpc:N}=L(),S=J(),{success:$,error:A}=I(),l=b(()=>k.params.provider),i=b(()=>({google:"Google",github:"GitHub"})[l.value]||l.value),y=p(!0),o=p(null),w=p(!1),c=p(!1),B=async()=>{var a,e,u;try{const{code:s,state:n,error:x}=k.query;if(console.log("OAuth callback params:",{provider:l.value,hasCode:!!s,hasState:!!n,hasError:!!x}),x)throw new Error("認証がキャンセルされました");if(!s||!n)throw new Error("認証情報が不足しています");try{const m=n.replace(/-/g,"+").replace(/_/g,"/"),V="=".repeat((4-m.length%4)%4),M=JSON.parse(atob(m+V));c.value=M.action==="register"}catch(m){console.error("Failed to parse state:",m),c.value=!1}const d=await N.auth.oauthCallback({provider:l.value,code:s,state:n});await S.setAuthData({accessToken:d.accessToken,refreshToken:d.refreshToken,user:d.user}),w.value=!0,$(c.value?`${i.value}でアカウントを作成しました`:`${i.value}でログインしました`),setTimeout(()=>{j.push(d.redirectUrl||"/rules")},1500)}catch(s){console.error("OAuth callback error:",s),(a=s.message)!=null&&a.includes("already exists")?o.value="このアカウントは既に別のユーザーに使用されています":(e=s.message)!=null&&e.includes("email not verified")?o.value="メールアドレスの確認が必要です":(u=s.message)!=null&&u.includes("cancelled")?o.value="認証がキャンセルされました":o.value=s.message||"認証処理中にエラーが発生しました",A(o.value)}finally{y.value=!1}},E=()=>{C(`/auth?provider=${l.value}`)};return q(()=>{B()}),K({title:`${i.value}認証 - ZXCV`,meta:[{name:"robots",content:"noindex,nofollow"}]}),(a,e)=>{const u=O,s=D,n=R;return v(),f("div",X,[t("div",Z,[g(n,{padding:"lg",class:"text-center"},{default:_(()=>[r(y)?(v(),f("div",P,[g(u,{size:"lg",class:"mx-auto"}),e[1]||(e[1]=t("h2",{class:"text-xl font-semibold text-gray-900 dark:text-white"}," 認証処理中... ",-1)),t("p",Q,h(r(i))+"アカウントで"+h(r(c)?"アカウントを作成":"ログイン")+"しています ",1)])):r(o)?(v(),f("div",W,[e[4]||(e[4]=t("div",{class:"w-16 h-16 bg-red-100 dark:bg-red-900/20 rounded-full flex items-center justify-center mx-auto"},[t("svg",{class:"w-8 h-8 text-red-600 dark:text-red-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1)),e[5]||(e[5]=t("h2",{class:"text-xl font-semibold text-gray-900 dark:text-white"}," 認証エラー ",-1)),t("p",Y,h(r(o)),1),t("div",ee,[g(s,{variant:"primary",onClick:e[0]||(e[0]=x=>("navigateTo"in a?a.navigateTo:r(C))("/auth"))},{default:_(()=>e[2]||(e[2]=[T(" ログインページに戻る ")])),_:1,__:[2]}),g(s,{variant:"secondary",onClick:E},{default:_(()=>e[3]||(e[3]=[T(" もう一度試す ")])),_:1,__:[3]})])])):r(w)?(v(),f("div",te,e[6]||(e[6]=[t("div",{class:"w-16 h-16 bg-green-100 dark:bg-green-900/20 rounded-full flex items-center justify-center mx-auto"},[t("svg",{class:"w-8 h-8 text-green-600 dark:text-green-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})])],-1),t("h2",{class:"text-xl font-semibold text-gray-900 dark:text-white"}," 認証成功 ",-1),t("p",{class:"text-gray-600 dark:text-gray-400"}," リダイレクトしています... ",-1)]))):F("",!0)]),_:1})])])}}}),pe=U(se,[["__scopeId","data-v-bd9f73ff"]]);export{pe as default};
