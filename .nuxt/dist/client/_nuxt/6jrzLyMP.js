import{X as y,r as l,m as w,Y as u,h as i,n as I}from"./CyjY5H8A.js";const d=y("auth",()=>{const s=l(null),o=l(null),a=l(null),c=l(!1),v=w(()=>!!s.value&&!!o.value),f=()=>{{const e=localStorage.getItem("access_token"),n=localStorage.getItem("refresh_token"),r=localStorage.getItem("user");if(e&&(o.value=e),n&&(a.value=n),r)try{s.value=JSON.parse(r)}catch(t){console.error("Failed to parse stored user data:",t)}}},h=async e=>{c.value=!0;try{const t=await i().$rpc.auth.login({email:e.email,password:e.password});return o.value=t.accessToken,a.value=t.refreshToken,s.value=t.user,localStorage.setItem("access_token",t.accessToken),localStorage.setItem("refresh_token",t.refreshToken),localStorage.setItem("user",JSON.stringify(t.user)),t}catch(n){throw await p(),n}finally{c.value=!1}},g=async e=>{c.value=!0;try{const t=await i().$rpc.auth.register(e);return await h({email:e.email,password:e.password}),t}finally{c.value=!1}},p=async()=>{s.value=null,o.value=null,a.value=null,localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token"),localStorage.removeItem("user"),await I("/login")},m=async()=>{if(!a.value)throw new Error("No refresh token available");try{const r=await i().$rpc.auth.refresh({refreshToken:a.value});return o.value=r.accessToken,a.value=r.refreshToken,localStorage.setItem("access_token",r.accessToken),localStorage.setItem("refresh_token",r.refreshToken),r}catch(e){throw await p(),e}},k=async()=>{if(!o.value)return null;try{const r=await i().$rpc.users.settings();return s.value={id:r.id,email:r.email,username:r.username,emailVerified:r.email_verified},localStorage.setItem("user",JSON.stringify(r)),r}catch(e){return console.error("Failed to fetch current user:",e),null}},S=e=>{s.value&&(s.value={...s.value,...e},localStorage.setItem("user",JSON.stringify(s.value)))},T=async e=>{o.value=e.accessToken,a.value=e.refreshToken,s.value=e.user,localStorage.setItem("access_token",e.accessToken),localStorage.setItem("refresh_token",e.refreshToken),localStorage.setItem("user",JSON.stringify(e.user))};return f(),{user:u(s),accessToken:u(o),refreshToken:u(a),isLoading:u(c),isAuthenticated:v,login:h,register:g,logout:p,refreshAccessToken:m,fetchCurrentUser:k,updateUser:S,setAuthData:T,initializeAuth:f}});export{d as u};
