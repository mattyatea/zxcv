{"version":3,"file":"join-9iUkfkQc.js","sources":["../../../../pages/organizations/join.vue"],"sourcesContent":["<template>\n  <div class=\"min-h-screen bg-gray-50 dark:bg-gray-950 flex items-center justify-center px-4\">\n    <div class=\"max-w-md w-full\">\n      <!-- ローディング -->\n      <div v-if=\"loading\" class=\"text-center\">\n        <CommonLoadingSpinner size=\"lg\" />\n        <p class=\"mt-4 text-gray-600 dark:text-gray-400\">{{ $t('organizations.join.verifying') }}</p>\n      </div>\n\n      <!-- エラー -->\n      <div v-else-if=\"error\" class=\"text-center\">\n        <div class=\"w-16 h-16 bg-red-100 dark:bg-red-900/30 rounded-full flex items-center justify-center mx-auto mb-4\">\n          <svg class=\"w-8 h-8 text-red-600 dark:text-red-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\" />\n          </svg>\n        </div>\n        <h2 class=\"text-2xl font-bold text-gray-900 dark:text-gray-100 mb-2\">\n          {{ $t('organizations.join.failed') }}\n        </h2>\n        <p class=\"text-gray-600 dark:text-gray-400 mb-6\">{{ error }}</p>\n        <NuxtLink to=\"/organizations\">\n          <CommonButton variant=\"primary\">\n            {{ $t('organizations.join.backToOrganizations') }}\n          </CommonButton>\n        </NuxtLink>\n      </div>\n\n      <!-- 成功 -->\n      <div v-else-if=\"success\" class=\"text-center\">\n        <div class=\"w-16 h-16 bg-green-100 dark:bg-green-900/30 rounded-full flex items-center justify-center mx-auto mb-4\">\n          <svg class=\"w-8 h-8 text-green-600 dark:text-green-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M5 13l4 4L19 7\" />\n          </svg>\n        </div>\n        <h2 class=\"text-2xl font-bold text-gray-900 dark:text-gray-100 mb-2\">\n          {{ $t('organizations.join.joined') }}\n        </h2>\n        <p class=\"text-gray-600 dark:text-gray-400 mb-6\">\n          {{ organization?.displayName || organization?.name }} {{ $t('organizations.join.welcome') }}\n        </p>\n        <NuxtLink :to=\"`/organizations/${organization?.id}`\">\n          <CommonButton variant=\"primary\">\n            {{ $t('organizations.join.goToOrganization') }}\n          </CommonButton>\n        </NuxtLink>\n      </div>\n\n      <!-- 未ログイン -->\n      <div v-else-if=\"!isAuthenticated\" class=\"text-center\">\n        <div class=\"w-16 h-16 bg-blue-100 dark:bg-blue-900/30 rounded-full flex items-center justify-center mx-auto mb-4\">\n          <svg class=\"w-8 h-8 text-blue-600 dark:text-blue-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z\" />\n          </svg>\n        </div>\n        <h2 class=\"text-2xl font-bold text-gray-900 dark:text-gray-100 mb-2\">\n          {{ $t('organizations.join.loginRequired') }}\n        </h2>\n        <p class=\"text-gray-600 dark:text-gray-400 mb-6\">\n          {{ $t('organizations.join.loginToJoin') }}\n        </p>\n        <NuxtLink :to=\"`/login?redirect=/organizations/join?token=${token}`\">\n          <CommonButton variant=\"primary\">\n            {{ $t('organizations.join.login') }}\n          </CommonButton>\n        </NuxtLink>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { onMounted, ref } from \"vue\";\nimport { useToast } from \"~/composables/useToast\";\nimport { useAuthStore } from \"~/stores/auth\";\n\ninterface Organization {\n\tid: string;\n\tname: string;\n\tdisplayName?: string;\n}\n\nconst { t } = useI18n();\nconst route = useRoute();\nconst { $rpc } = useNuxtApp();\nconst authStore = useAuthStore();\nconst { isAuthenticated } = storeToRefs(authStore);\nconst { error: toastError } = useToast();\n\nconst loading = ref(false);\nconst error = ref(\"\");\nconst success = ref(false);\nconst organization = ref<Organization | null>(null);\nconst token = computed(() => route.query.token as string);\n\nconst acceptInvitation = async () => {\n\tif (!token.value) {\n\t\terror.value = t(\"organizations.join.noToken\");\n\t\treturn;\n\t}\n\n\tloading.value = true;\n\terror.value = \"\";\n\n\ttry {\n\t\tconst response = await $rpc.organizations.acceptInvitation({\n\t\t\ttoken: token.value,\n\t\t});\n\n\t\tsuccess.value = true;\n\t\torganization.value = response.organization;\n\t} catch (err) {\n\t\tconst errorMessage = err instanceof Error ? err.message : t(\"organizations.join.failed\");\n\t\terror.value = errorMessage;\n\t\ttoastError(errorMessage);\n\t} finally {\n\t\tloading.value = false;\n\t}\n};\n\nonMounted(() => {\n\tif (isAuthenticated.value && token.value) {\n\t\tacceptInvitation();\n\t}\n});\n\n// Watch for authentication changes\nwatch(isAuthenticated, (newValue) => {\n\tif (newValue && token.value && !success.value && !error.value) {\n\t\tacceptInvitation();\n\t}\n});\n</script>"],"names":["_ssrRenderAttrs","_mergeProps","_ssrRenderComponent","$t","_push","_parent","_","_scopeId","_createVNode","_ssrInterpolate","_unref"],"mappings":"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"}